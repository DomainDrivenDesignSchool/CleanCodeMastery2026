# جمع‌بندی جلسه آنلاین — چهارشنبه ۲۹ بهمن

---

## ما چی بررسی کردیم؟

دو تا فایل اصلی از سورس‌کد FastAPI رو بررسی کردیم: `routing.py` و `utils.py`. هدفمون پیدا کردن code smell ها و مشکلات ساختاری بود که باعث میشه نگهداری و توسعه کد سخت‌تر بشه.

---

## به چه نتیجه‌ای رسیدیم؟

### فایل `routing.py`

۱. **تکرار ۳,۰۰۰ خطی متدهای HTTP** — متدهای `get()`, `put()`, `post()`, `delete()`, `options()`, `head()`, `patch()`, `trace()` کاملاً کپی‌پیست هم‌دیگن. تنها تفاوتشون `methods=["GET"]` در مقابل `methods=["PUT"]` و ... هست. یعنی ۶۸ درصد فایل فقط تکراره.

۲. **Shadow naming توی `request_response()`** — یه تابع داخلی دقیقاً هم‌نام تابع بیرونیش تعریف شده (هر دو `app` نام دارن) که گیج‌کننده‌ست.

۳. **God Function: `get_request_handler()`** — حدود ۱۵۵ خط با ۶ مسئولیت مختلف: parse کردن body، تشخیص content-type، مدیریت خطا، حل dependency ها، اجرای endpoint، و ساختن response.

### فایل `utils.py`

۴. **متد `ensure_multipart_is_installed()` با سه لایه try/except تو در تو** — خوندنش سخته و چک version روی پکیج اشتباهی هم بی‌معنیه.

۵. **متد `get_dependant()` بزرگ و چندوظیفه‌ای** — توی یه حلقه سه تا کار متفاوت انجام میده: هندل Depends، تشخیص تایپ‌های خاص مثل Request و WebSocket، و مسیریابی فیلدهای عادی.

۶. **صدا زدن بازگشتی بدون مکانیزم قطع** — `get_dependant()` خودش رو recursive صدا میزنه ولی هیچ depth limit یا چک circular dependency نداره. همین مشکل برای `get_flat_dependant()` و `solve_dependencies()` هم وجود داره.  ممکنه جای دیگه‌ای محافظتی باشه.

۷. **Implicit Coupling بین `_should_embed_body_fields()` و `get_body_field()`** — هر دو روی `body_params` کار میکنن و خروجی اولی ورودی دومیه، ولی رابطه رسمی‌ای بینشون نیست. اگه کسی یکیشون رو بدون دیگری صدا بزنه باگ ساکت ایجاد میشه.

---

## مهم‌ترین تصمیم‌ها و اختلاف‌نظرها

- در مورد این که احتمالا برنامه نویس های FastApi باید افراد قوی از نظر فنی باشند پس چرا این مشکلات رو دارند بحث کردیم

- ممکن است این فایل ها نسخه خاص در برنچ خاصی بوده باشه و بعدا خود تیم ریفکتور کرده باشند بحث کردیم

- با کمک گیت و ابزار های گیت چطور میتونیم تغیرات رو متوجه بشیم و به code smell ها برسیم
